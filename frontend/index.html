<!DOCTYPE html>
<html>

<head>
    <script>
        const map_tl_y = 36.322444
        const map_tl_x = -115.470360
        const map_br_y = 35.946912
        const map_br_x = -114.845475
        const url = 'http://192.168.0.9:9357';
        document.onmousedown = function (ev) {
            var e = ev || event; //IE浏览器直接使用event或者window.event得到事件本身。
            map = document.getElementById('vegas_map')
            var rect = e.target.getBoundingClientRect();
            if (e.target != map) {
                return
            }
            var x_relative = e.clientX - rect.left; //x position within the element.
            var y_relative = e.clientY - rect.top;  //y position within the element.
            x = x_relative / map.width * (map_br_x - map_tl_x) + map_tl_x
            y = y_relative / map.height * (map_br_y - map_tl_y) + map_tl_y
            document.getElementById("longitude").value = x
            document.getElementById("latitude").value = y
        };
        function findPos(obj) {
            var curleft = 0;
            var curtop = 0;
            if (obj.offsetParent) {
                do {
                    curleft += obj.offsetLeft;
                    curtop += obj.offsetTop;
                } while (obj = obj.offsetParent);

                return { X: curleft, Y: curtop };
            }
        }
        function search() {
            //https://www.yelp.com/search?find_desc=sandwich&l=37.372191699999995%2C-122.00416789999998"
            //const url = 'http://172.30.144.57:8080';
            longitude = document.getElementById("longitude").value
            latitude = document.getElementById("latitude").value
            destinaion = document.getElementById("destinaion").value
            radius = document.getElementById("radius").value
            var e = document.getElementById("ranking");
            var rank_opt = e.options[e.selectedIndex].value;
            uri = url + "/seach?find_desc=" + destinaion + "&lat=" + latitude + "&lon=" + longitude + "&r=" + radius + "&ranking=" + rank_opt
            fetch(uri).then(response =>
                response.text().then(data => ({
                    data: data,
                    status: response.status
                })
                ).then(res => {
                    document.write(res.data)
                }));
        }
    </script>
</head>

<body>
    <h1>Yelp</h1>
    <label><b>Longitude</b></label>
    <input id="longitude" type="text" value=-115.1786369 name="longitude" required>

    <label><b>Latitude</b></label>
    <input id="latitude" type="text" value="36.1440384" name="latitude" required>

    <label><b>Destination</b></label>
    <input id="destinaion" type="text" value="sandwich" name="destination" required>
    <button type="button" onclick="search()">Search</button>
    <p> </p>
    <label><b>Radius</b></label>
    <input id="radius" type="text" value="1000" name="radius" required>

    Ranking: <select id="ranking">
        <option value="rating">rating</option>
        <option value="distance">distance</option>
    </select>
    <p>I don not know why this offset</p>

    <p> </p>
    <img id="vegas_map" , src="images/las_vegas_map.png">
</body>

</html>